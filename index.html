<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breakup OS v2.0 | Survival Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom Font Import - Inter for clean UI */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfaf8; /* Warm off-white */
            color: #44403c; /* Stone 700 */
        }

        /* Chart Container specific styles as requested */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 300px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Smooth transitions */
        .transition-all-300 {
            transition: all 0.3s ease-in-out;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e; 
        }

        /* Active Tab Styling */
        .nav-btn.active {
            background-color: #ffe4e6; /* Rose 100 */
            color: #be123c; /* Rose 700 */
            border-left: 4px solid #be123c;
        }
        .nav-btn {
            border-left: 4px solid transparent;
        }

        /* Card Hover Effects */
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
    <!-- Chosen Palette: Warm Neutrals with Rose/Coral Accents. 
         Background: Stone-50 (#fcfaf8). 
         Text: Stone-700 (#44403c). 
         Accents: Rose-500 (#f43f5e) for primary actions, Emerald-500 for success states. -->

    <!-- Application Structure Plan:
         The app acts as a personal "Operating System" update for the user's life.
         1. Header: Quick status check-in (Mood).
         2. Sidebar Nav: Maps to the 5 blog sections (Update, Detox, Energy, Narrative, Prize).
         3. Dynamic Main Content:
            - 'System Update': Checklist for the "Rot Era" (Validation).
            - 'Firewall': Interactive visual toggles for blocking/muting and a No-Contact Streak counter.
            - 'Energy Monitor': A Chart.js Doughnut chart allowing users to visually "reallocate" energy from "Ex" to "Self/Hobbies".
            - 'Debug Log': An interactive "Expectation vs Reality" text swapper to de-pink-tint memories.
            - 'Main Character': Affirmation generator and summary of progress.
         Rationale: This structure gamifies the healing process, making it feel like an active project ("upgrading the OS") rather than a passive suffering state. -->
    
    <!-- Visualization & Content Choices:
         1. Energy Chart (Chart.js): Goal -> Change/Redirect. Viz -> Doughnut Chart. Interaction -> Clicking buttons updates data arrays to shrink the "Obsessing" slice. Justification -> Visually demonstrates the concept of "surplus energy" moving to new places.
         2. No-Contact Counter: Goal -> Inform/Motivate. Viz -> Large numeric display. Interaction -> Increment/Reset. Justification -> Simple gamification encourages persistence.
         3. Reality Check (JS Text Swap): Goal -> Analysis/Re-write Narrative. Viz -> Two-column comparison. Interaction -> Button click reveals "Reality". Justification -> Directly addresses the "pink-tinted memories" point in the report.
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Mobile Header -->
    <header class="md:hidden bg-white p-4 border-b border-stone-200 flex justify-between items-center shadow-sm z-20">
        <h1 class="text-lg font-bold text-stone-800">üíî Breakup OS v2.0</h1>
        <button id="mobile-menu-btn" class="text-2xl focus:outline-none">‚ò∞</button>
    </header>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="bg-white w-full md:w-64 flex-shrink-0 border-r border-stone-200 h-full flex flex-col transform -translate-x-full md:translate-x-0 transition-transform duration-300 absolute md:relative z-10">
        <div class="p-6 border-b border-stone-100 hidden md:block">
            <h1 class="text-xl font-bold text-rose-600 tracking-tight">üíî Breakup OS <span class="text-xs text-stone-400 font-normal">v2.0</span></h1>
            <p class="text-xs text-stone-500 mt-1">System Status: <span id="system-status-text" class="font-medium text-amber-500">Healing...</span></p>
        </div>
        
        <div class="flex-1 overflow-y-auto py-4 space-y-1">
            <button onclick="switchTab('tab-update')" class="nav-btn active w-full text-left px-6 py-3 text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors flex items-center gap-3">
                <span>üîÑ</span> 1. System Update
            </button>
            <button onclick="switchTab('tab-detox')" class="nav-btn w-full text-left px-6 py-3 text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors flex items-center gap-3">
                <span>üõ°Ô∏è</span> 2. Firewall / Detox
            </button>
            <button onclick="switchTab('tab-energy')" class="nav-btn w-full text-left px-6 py-3 text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors flex items-center gap-3">
                <span>‚ö°</span> 3. Energy Monitor
            </button>
            <button onclick="switchTab('tab-narrative')" class="nav-btn w-full text-left px-6 py-3 text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors flex items-center gap-3">
                <span>üìù</span> 4. Debug Log
            </button>
            <button onclick="switchTab('tab-prize')" class="nav-btn w-full text-left px-6 py-3 text-sm font-medium text-stone-600 hover:bg-stone-50 transition-colors flex items-center gap-3">
                <span>üèÜ</span> 5. Main Character
            </button>
        </div>

        <div class="p-4 bg-stone-50 border-t border-stone-200">
            <label class="text-xs font-semibold text-stone-500 uppercase tracking-wider block mb-2">Current Vibe</label>
            <input type="range" id="mood-slider" min="0" max="100" value="20" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-rose-500">
            <div class="flex justify-between text-xs text-stone-400 mt-1">
                <span>Rotting</span>
                <span>Thriving</span>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto bg-stone-50 p-4 md:p-8 md:pb-24" id="main-content">
        
        <!-- Tab 1: System Update (Acceptance) -->
        <section id="tab-update" class="max-w-4xl mx-auto space-y-6 fade-in">
            <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-stone-100">
                <h2 class="text-2xl font-bold text-stone-800 mb-2">Step 1: Accept the "Software Update" üîÑ</h2>
                <p class="text-stone-600 mb-6 leading-relaxed">
                    Think of this breakup like a mandatory OS update. It's annoying, it glitches, and your system feels slow. But the patch is necessary to fix bugs and improve security. Do not force a restart‚Äîlet the loading bar fill up.
                </p>

                <div class="mb-8">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm font-medium text-stone-700">Installation Progress</span>
                        <span class="text-sm font-medium text-rose-500" id="progress-text">0%</span>
                    </div>
                    <div class="w-full bg-stone-100 rounded-full h-4">
                        <div id="progress-bar" class="bg-rose-400 h-4 rounded-full transition-all duration-1000" style="width: 5%"></div>
                    </div>
                    <p class="text-xs text-stone-400 mt-2">Update Status: <span id="status-msg">Installing Grief Drivers...</span></p>
                </div>

                <h3 class="font-semibold text-lg text-stone-800 mb-4">The "Rot Era" Checklist</h3>
                <p class="text-sm text-stone-500 mb-4">It is okay to do nothing. Tick these off to prove you are surviving.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <label class="flex items-center space-x-3 p-3 border border-stone-200 rounded-lg cursor-pointer hover:bg-stone-50 transition-colors">
                        <input type="checkbox" class="rot-check form-checkbox h-5 w-5 text-rose-500 rounded focus:ring-rose-500" onchange="updateProgress()">
                        <span class="text-stone-700">Ate cereal for dinner</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 border border-stone-200 rounded-lg cursor-pointer hover:bg-stone-50 transition-colors">
                        <input type="checkbox" class="rot-check form-checkbox h-5 w-5 text-rose-500 rounded focus:ring-rose-500" onchange="updateProgress()">
                        <span class="text-stone-700">Watched same show x10</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 border border-stone-200 rounded-lg cursor-pointer hover:bg-stone-50 transition-colors">
                        <input type="checkbox" class="rot-check form-checkbox h-5 w-5 text-rose-500 rounded focus:ring-rose-500" onchange="updateProgress()">
                        <span class="text-stone-700">Cried in the shower</span>
                    </label>
                    <label class="flex items-center space-x-3 p-3 border border-stone-200 rounded-lg cursor-pointer hover:bg-stone-50 transition-colors">
                        <input type="checkbox" class="rot-check form-checkbox h-5 w-5 text-rose-500 rounded focus:ring-rose-500" onchange="updateProgress()">
                        <span class="text-stone-700">Drank water today</span>
                    </label>
                </div>
            </div>
        </section>

        <!-- Tab 2: Digital Detox -->
        <section id="tab-detox" class="max-w-4xl mx-auto space-y-6 hidden fade-in">
            <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-stone-100">
                <h2 class="text-2xl font-bold text-stone-800 mb-2">Step 2: Firewall Settings (Detox) üõ°Ô∏è</h2>
                <p class="text-stone-600 mb-6">
                    You cannot heal in the same environment that infected you. Checking their stories is a security breach. Activate your firewall now.
                </p>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- No Contact Counter -->
                    <div class="bg-stone-50 rounded-xl p-6 border border-stone-200 text-center">
                        <h3 class="text-sm font-semibold text-stone-500 uppercase tracking-widest mb-4">No-Contact Streak</h3>
                        <div class="flex items-center justify-center gap-4 mb-4">
                            <button onclick="adjustDays(-1)" class="w-10 h-10 rounded-full bg-white border border-stone-300 text-stone-500 hover:bg-stone-100 text-xl">-</button>
                            <span id="streak-days" class="text-6xl font-bold text-rose-500 font-mono">0</span>
                            <button onclick="adjustDays(1)" class="w-10 h-10 rounded-full bg-white border border-stone-300 text-stone-500 hover:bg-stone-100 text-xl">+</button>
                        </div>
                        <p class="text-stone-600 font-medium">Days without a text</p>
                        <p id="streak-msg" class="text-xs text-stone-400 mt-2">Even 1 hour counts. Keep going.</p>
                        <button onclick="resetStreak()" class="mt-4 text-xs text-red-400 hover:text-red-600 underline">Reset Streak (It happens)</button>
                    </div>

                    <!-- App Permissions -->
                    <div class="bg-stone-50 rounded-xl p-6 border border-stone-200">
                        <h3 class="text-sm font-semibold text-stone-500 uppercase tracking-widest mb-4">Revoke Access</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                                <span class="flex items-center gap-2"><span class="text-xl">üì∏</span> Instagram</span>
                                <button onclick="toggleBlock(this)" class="px-3 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700 border border-green-200 hover:opacity-80 transition-colors">Following</button>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                                <span class="flex items-center gap-2"><span class="text-xl">üéµ</span> TikTok</span>
                                <button onclick="toggleBlock(this)" class="px-3 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700 border border-green-200 hover:opacity-80 transition-colors">Following</button>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm">
                                <span class="flex items-center gap-2"><span class="text-xl">üì±</span> Number</span>
                                <button onclick="toggleBlock(this)" class="px-3 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700 border border-green-200 hover:opacity-80 transition-colors">Saved</button>
                            </div>
                        </div>
                        <p class="text-xs text-stone-400 mt-4 italic text-center">*Simulation only. Go do it on your real phone.*</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 3: Energy Redirect -->
        <section id="tab-energy" class="max-w-4xl mx-auto space-y-6 hidden fade-in">
            <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-stone-100">
                <h2 class="text-2xl font-bold text-stone-800 mb-2">Step 3: Redirect Energy ‚ö°</h2>
                <p class="text-stone-600 mb-6">
                    A breakup creates a massive surplus of emotional energy. If you don't use it, it turns into anxiety. Reallocate your resources below.
                </p>

                <div class="flex flex-col lg:flex-row gap-8 items-center">
                    <div class="w-full lg:w-1/2">
                        <!-- Chart Container - Strictly Sized -->
                        <div class="chart-container">
                            <canvas id="energyChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="w-full lg:w-1/2 space-y-4">
                        <h3 class="font-semibold text-lg text-stone-800">Available Actions</h3>
                        <p class="text-sm text-stone-500">Click to move energy from "Obsessing" to productive sectors.</p>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="reallocateEnergy('gym')" class="p-3 text-left bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-lg transition-colors group">
                                <span class="text-2xl block mb-1">üèãÔ∏è‚Äç‚ôÇÔ∏è</span>
                                <span class="font-semibold text-emerald-800 text-sm">Hit the Gym</span>
                                <span class="text-xs text-emerald-600 block mt-1">+ Endorphins</span>
                            </button>
                            <button onclick="reallocateEnergy('hobby')" class="p-3 text-left bg-purple-50 hover:bg-purple-100 border border-purple-200 rounded-lg transition-colors group">
                                <span class="text-2xl block mb-1">üß∂</span>
                                <span class="font-semibold text-purple-800 text-sm">New Hobby</span>
                                <span class="text-xs text-purple-600 block mt-1">+ Skill Gain</span>
                            </button>
                            <button onclick="reallocateEnergy('friends')" class="p-3 text-left bg-amber-50 hover:bg-amber-100 border border-amber-200 rounded-lg transition-colors group">
                                <span class="text-2xl block mb-1">üëØ‚Äç‚ôÇÔ∏è</span>
                                <span class="font-semibold text-amber-800 text-sm">Bestie Pivot</span>
                                <span class="text-xs text-amber-600 block mt-1">+ Support</span>
                            </button>
                            <button onclick="reallocateEnergy('skin')" class="p-3 text-left bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors group">
                                <span class="text-2xl block mb-1">üß¥</span>
                                <span class="font-semibold text-blue-800 text-sm">Skincare</span>
                                <span class="text-xs text-blue-600 block mt-1">+ Glow Up</span>
                            </button>
                        </div>
                        <button onclick="resetChart()" class="text-xs text-stone-400 underline w-full text-center hover:text-stone-600 mt-2">Reset Simulation</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 4: Narrative Rewrite -->
        <section id="tab-narrative" class="max-w-4xl mx-auto space-y-6 hidden fade-in">
            <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-stone-100">
                <h2 class="text-2xl font-bold text-stone-800 mb-2">Step 4: Re-Write the Narrative ‚úçÔ∏è</h2>
                <p class="text-stone-600 mb-6">
                    Memory has a "Pink Tint" filter. You remember the sunset dates but forget the waiting. Use the tool below to debug your memory logs.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-stretch">
                    <!-- The Fantasy -->
                    <div class="bg-rose-50 border border-rose-100 rounded-xl p-6 flex flex-col relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl">üí≠</div>
                        <h3 class="font-bold text-rose-800 mb-3">The "Pink Tint" Memory</h3>
                        <p class="text-rose-900 italic mb-4 text-lg" id="pink-text">"We were so perfect together, they just got scared..."</p>
                        <div class="mt-auto">
                            <span class="text-xs font-semibold text-rose-400 bg-white px-2 py-1 rounded">Status: Delusional</span>
                        </div>
                    </div>

                    <!-- The Reality -->
                    <div class="bg-stone-800 border border-stone-700 rounded-xl p-6 flex flex-col relative overflow-hidden text-white">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl">‚ö†Ô∏è</div>
                        <h3 class="font-bold text-stone-300 mb-3">The System Log (Reality)</h3>
                        <div id="reality-content" class="min-h-[80px] flex items-center justify-center">
                            <button onclick="revealTruth()" class="bg-stone-600 hover:bg-stone-500 text-stone-200 px-4 py-2 rounded-lg text-sm transition-colors shadow-lg border border-stone-500">
                                Click to Run Diagnostics
                            </button>
                        </div>
                        <div class="mt-auto pt-4">
                            <span class="text-xs font-semibold text-stone-500 bg-stone-900 px-2 py-1 rounded">Status: Accurate</span>
                        </div>
                    </div>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-6">
                    <p class="text-sm text-yellow-800">
                        <strong>Pro Tip:</strong> Open your Notes app right now. Create a list titled "Why It Didn't Work." Read it every time you want to text them at 2 AM.
                    </p>
                </div>
            </div>
        </section>

        <!-- Tab 5: The Prize -->
        <section id="tab-prize" class="max-w-4xl mx-auto space-y-6 hidden fade-in">
            <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-stone-100 text-center">
                <div class="w-16 h-16 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center text-3xl mx-auto mb-4">üèÜ</div>
                <h2 class="text-3xl font-bold text-stone-800 mb-2">You Are The Prize</h2>
                <p class="text-stone-600 mb-8 max-w-2xl mx-auto">
                    The breakup wasn't a rejection; it was a redirection. You aren't starting over from scratch, you're starting from experience.
                </p>

                <div class="bg-gradient-to-r from-rose-50 to-indigo-50 p-1 rounded-2xl max-w-lg mx-auto shadow-lg transform transition-transform hover:scale-105 duration-300">
                    <div class="bg-white rounded-xl p-8 border border-white/50">
                        <h3 class="text-xs font-bold text-stone-400 uppercase tracking-widest mb-2">Main Character Energy</h3>
                        <p id="affirmation-text" class="text-xl md:text-2xl font-serif text-stone-800 font-medium leading-relaxed">
                            "My value doesn't drop just because someone didn't know how to appreciate the investment."
                        </p>
                        <div class="mt-6 flex justify-center">
                            <button onclick="newAffirmation()" class="flex items-center gap-2 text-sm font-semibold text-rose-500 hover:text-rose-600 transition-colors">
                                <span>‚ú®</span> Generate New Mantra
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-12 text-stone-400 text-sm">
                    <p>System reboot complete. Welcome to Version 2.0.</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- State Management ---
        const state = {
            currentTab: 'tab-update',
            rottenChecklist: 0,
            noContactDays: 0,
            chartData: [90, 3, 3, 4], // Obsessing, Gym, Hobby, Friends
            narrativeIndex: 0
        };

        // --- Navigation Logic ---
        function switchTab(tabId) {
            // Hide all sections
            document.querySelectorAll('section').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('block');
            });
            // Show target section
            const target = document.getElementById(tabId);
            target.classList.remove('hidden');
            target.classList.add('block');
            
            // Update Tab Styles
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            // Find the button that called this (imperfect but functional for this scope) or match by text
            // Simple approach: re-query buttons based on onclick attribute or ID mapping
            const indexMap = {
                'tab-update': 0, 'tab-detox': 1, 'tab-energy': 2, 'tab-narrative': 3, 'tab-prize': 4
            };
            const buttons = document.querySelectorAll('.nav-btn');
            if(buttons[indexMap[tabId]]) {
                buttons[indexMap[tabId]].classList.add('active');
            }

            // Mobile menu close on selection
            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('-translate-x-full');
            }
        }

        // --- Mobile Menu ---
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        });

        // --- Step 1: Progress Logic ---
        function updateProgress() {
            const checks = document.querySelectorAll('.rot-check:checked').length;
            const total = document.querySelectorAll('.rot-check').length;
            const percentage = Math.round((checks / total) * 100);
            
            const bar = document.getElementById('progress-bar');
            const text = document.getElementById('progress-text');
            const msg = document.getElementById('status-msg');

            bar.style.width = percentage + '%';
            text.innerText = percentage + '%';

            if (percentage < 30) {
                bar.className = "h-4 rounded-full transition-all duration-1000 bg-rose-400";
                msg.innerText = "Installing Grief Drivers...";
            } else if (percentage < 70) {
                bar.className = "h-4 rounded-full transition-all duration-1000 bg-amber-400";
                msg.innerText = "Processing Emotions...";
            } else {
                bar.className = "h-4 rounded-full transition-all duration-1000 bg-emerald-500";
                msg.innerText = "Update Nearly Complete. Ready for Reboot.";
            }
        }

        // --- Step 2: No Contact Logic ---
        function adjustDays(amount) {
            state.noContactDays += amount;
            if(state.noContactDays < 0) state.noContactDays = 0;
            
            const display = document.getElementById('streak-days');
            display.innerText = state.noContactDays;
            display.classList.remove('scale-110');
            void display.offsetWidth; // trigger reflow
            display.classList.add('scale-110', 'transition-transform');
            setTimeout(() => display.classList.remove('scale-110'), 200);

            const msgs = [
                "Even 1 hour counts.",
                "Okay, we're building momentum.",
                "Look at you, protecting your peace!",
                "They are literally fading from memory.",
                "Main Character Status Unlocked."
            ];
            const msgIndex = Math.min(Math.floor(state.noContactDays / 3), msgs.length - 1);
            document.getElementById('streak-msg').innerText = msgs[msgIndex];
        }

        function resetStreak() {
            if(confirm("Did you actually text them? It's okay, healing isn't linear. Resetting...")) {
                state.noContactDays = 0;
                document.getElementById('streak-days').innerText = "0";
                document.getElementById('streak-msg').innerText = "Restarting the timer. You got this.";
            }
        }

        function toggleBlock(btn) {
            if(btn.innerText === "Following" || btn.innerText === "Saved") {
                btn.innerText = "Blocked üö´";
                btn.className = "px-3 py-1 text-xs font-bold rounded-full bg-stone-800 text-white border border-stone-600 hover:opacity-80 transition-colors";
            } else {
                btn.innerText = "Following"; // Reset for demo purposes
                btn.className = "px-3 py-1 text-xs font-bold rounded-full bg-green-100 text-green-700 border border-green-200 hover:opacity-80 transition-colors";
            }
        }

        // --- Step 3: Chart.js Logic ---
        let energyChart;
        function initChart() {
            const ctx = document.getElementById('energyChart').getContext('2d');
            energyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Obsessing over Ex', 'Gym/Health', 'Hobbies', 'Friends'],
                    datasets: [{
                        data: state.chartData,
                        backgroundColor: [
                            '#e7e5e4', // Stone 200 (Obsessing - bland color)
                            '#10b981', // Emerald 500
                            '#a855f7', // Purple 500
                            '#f59e0b'  // Amber 500
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { font: { family: 'Inter', size: 12 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw + '% Energy';
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        function reallocateEnergy(type) {
            // Decrease Obsessing (index 0)
            if(state.chartData[0] > 10) {
                state.chartData[0] -= 10;
                
                // Increase target
                if(type === 'gym' || type === 'skin') state.chartData[1] += 10;
                if(type === 'hobby') state.chartData[2] += 10;
                if(type === 'friends') state.chartData[3] += 10;
                
                energyChart.update();
            } else {
                alert("You are officially over them! Maximum energy redirected.");
            }
        }

        function resetChart() {
            state.chartData = [90, 3, 3, 4];
            energyChart.data.datasets[0].data = state.chartData;
            energyChart.update();
        }

        // --- Step 4: Narrative Logic ---
        const pinkMemories = [
            "We were so perfect together, they just got scared...",
            "But they had such good taste in music...",
            "Remember that weekend in the mountains?",
            "They said I was the only one who understood them..."
        ];
        
        const realityChecks = [
            "Reality: They left you on read for 8 hours regularly.",
            "Reality: You cried on your birthday because of them.",
            "Reality: They refused to label the relationship.",
            "Reality: Your friends actually hated them.",
            "Reality: They made you feel anxious more than safe."
        ];

        function revealTruth() {
            const container = document.getElementById('reality-content');
            // Random reality
            const truth = realityChecks[Math.floor(Math.random() * realityChecks.length)];
            
            container.innerHTML = `
                <div class="text-center fade-in">
                    <p class="text-xl font-bold text-rose-400 mb-2">‚ö†Ô∏è ERROR FOUND</p>
                    <p class="text-white text-lg">${truth}</p>
                    <button onclick="revealTruth()" class="mt-4 text-xs text-stone-400 hover:text-white underline">Run another diagnostic</button>
                </div>
            `;
            
            // Also cycle the pink memory to match the interaction flow
            state.narrativeIndex = (state.narrativeIndex + 1) % pinkMemories.length;
            document.getElementById('pink-text').innerText = `"${pinkMemories[state.narrativeIndex]}"`;
        }

        // --- Step 5: Affirmation Logic ---
        const affirmations = [
            "My value doesn't drop just because someone didn't know how to appreciate the investment.",
            "I am the lead character, this was just plot development.",
            "I am protecting my peace like it's a VIP section.",
            "The trash took itself out.",
            "I am attracting, not chasing."
        ];

        function newAffirmation() {
            const el = document.getElementById('affirmation-text');
            el.style.opacity = 0;
            setTimeout(() => {
                const rand = affirmations[Math.floor(Math.random() * affirmations.length)];
                el.innerText = `"${rand}"`;
                el.style.opacity = 1;
            }, 300);
        }

        // --- Mood Slider Logic ---
        document.getElementById('mood-slider').addEventListener('input', (e) => {
            const val = e.target.value;
            const status = document.getElementById('system-status-text');
            if(val < 25) {
                status.innerText = "Critical Failure";
                status.className = "font-medium text-stone-400";
            } else if (val < 50) {
                status.innerText = "Safe Mode";
                status.className = "font-medium text-amber-500";
            } else if (val < 80) {
                status.innerText = "Rebooting...";
                status.className = "font-medium text-blue-500";
            } else {
                status.innerText = "Operational";
                status.className = "font-medium text-emerald-500";
            }
        });

        // Initialize
        window.onload = function() {
            initChart();
            // Simple animation for fade-ins
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('opacity-100');
                    }
                });
            });
            document.querySelectorAll('section').forEach(s => observer.observe(s));
        };

    </script>
</body>
</html>